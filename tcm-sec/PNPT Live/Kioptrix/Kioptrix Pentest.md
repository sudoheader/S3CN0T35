# Kioptrix Pentest

Login Credentials:
```
john:TwoCow2
```

**Note**: `ifconfig` and `ip a` are not available on Kioptrix.

Use `ping 8.8.8.8`, Google Public DNS, to figure out what the IP address is for Kioptrix.
![[Pinging Google Public DNS.png]]
Notice the part on the first line where it says `from 172.16.58.134`. That is the IP address for Kioptrix.

To confirm, use `netdiscover` and see if it is a part of our network:
```bash
sudo netdiscover -r <IP_RANGE>/<SUBNET in CIDR notation> 
```
Our IP on the Kali VM is `172.16.58.129`. The range would be in /24 according to CIDR notation.
Change `$IP-ADDRESS` to the one that matches the IP address of Kioptrix.
```bash
sudo netdiscover -r 172.16.58.129/24
```

![[Running netdiscover.png]]

It is confirmed that the IP address for Kioptrix is `172.16.58.134`.
You can also use `export` so you don't have to keep typing the IP address for the target VM.
**Note**: this will only work temporarily in the shell session that we are in.
```bash
export IP-ADDRESS=172.16.58.134
```

## Active Scanning and Enumeration
Simple scan:
```bash
nmap $IP-ADDRESS
```

![[Running simple nmap scan.png]]

OS and version detection script scan with service/version detection and faster execution:
```bash
nmap -A -sC -SV -T4 $IP-ADDRESS
```

OS and version detection scan on all ports with faster execution: 
```bash
nmap $IP-ADDRESS -p- -T4 -A
```

No HTTPS:
![[Running HTTP.png]]

Information Disclosure:
![[Information Disclosure - 404 Not Found.png]]

Weak Encryption:
![[Insecure HTTPS.png]]

Testing strength of connection on various ciphersuites:
```bash
nmap -p443 --script=ssl-enum-ciphers $IP-ADDRESS
```

We should get back a grading of the ciphersuites on a scale from A-F:
![[Scoring ciphers with nmap.png]]


Vulnerability Scanner:
```bash
nikto -h http://$IP-ADDRESS
```

Outdated Apache:
![[Nikto Vulnerability scan.png]]

### Check for Security Headers
https://securityheaders.com

Install FoxyProxy for Firefox:
https://addons.mozilla.org/en-US/firefox/addon/foxyproxy-standard/

Information Disclosure - Response Headers:
![[Burp Suite Information Disclosure - Response Headers.png]]

---

## Directory Busting

**dirb**
**dirbuster**
**ffuf**
**dirsearch**
**gobuster**
**wffuf**
**feroxbuster**

Information Disclosure:
![[Information Disclosure - Usage Statistics.png]]

Running ffuf:
```bash
ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt:FUZZ -u http://172.16.58.134 -u http://$IP-ADDRESS/FUZZ
```
![[Running ffuf.png]]

## SMB

Information Disclosure:
```bash
smbclient -L \\\\$IP-ADDRESS\\
```

![[Running smbclient.png]]

```bash
smbclient \\\\$IP-ADDRESS\\IPC$
```

```bash
smbclient \\\\$IP-ADDRESS\\Admin$
```

## Metasploit

```bash
msfconsole
```

RHOSTS = REMOTE HOST(S)
RHOST = REMOTE HOST
LHOST = LOCAL HOST

Type:
```bash
use auxiliary/scanner/smb/smb_version
```

or:
```bash
use 12
```

Modify the `RHOSTS` to match IP of Kioptrix:
```bash
set RHOSTS $IP-ADDRESS
```

Run the check to find Samba version:
```bash
run
```

![[Running scanner for smb.png]]

## SSH

```bash
ssh $IP-ADDRESS -oKexAlgorithms=+diffie-hellman-group1-sha1 -c aes128-cbc -oHostKeyAlgorithms=+ssh-rsa
```

![[SSH full command.png]]

```bash
searchsploit samba 2.2
```

![[searchsploit samba.png]]

---

## trans2open

Make sure to set payload before running for  `use 1` :
![[use 1.png]]

